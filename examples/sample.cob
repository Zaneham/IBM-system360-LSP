000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. BANKLEDGER.
000300 AUTHOR. UNKNOWN PROGRAMMER.
000400 DATE-WRITTEN. 12TH JULY 1967.
000500 DATE-COMPILED.
000600 REMARKS. CORE LEDGER FOR DECIMALIZATION.
000700*    NEW ZEALAND DOLLAR CONVERSION SYSTEM.
000800*    DO NOT MODIFY WITHOUT AUTHORISATION.
000900
001000 ENVIRONMENT DIVISION.
001100 CONFIGURATION SECTION.
001200 SOURCE-COMPUTER. IBM-360.
001300 OBJECT-COMPUTER. IBM-360.
001400 SPECIAL-NAMES.
001500     CONSOLE IS OPERATOR-CONSOLE.
001600
001700 INPUT-OUTPUT SECTION.
001800 FILE-CONTROL.
001900     SELECT CUSTOMER-FILE
002000         ASSIGN TO SYS010-UR-2540R-S
002100         ORGANIZATION IS SEQUENTIAL
002200         ACCESS IS SEQUENTIAL.
002300     SELECT TRANSACTION-FILE
002400         ASSIGN TO SYS011-DA-2311-I
002500         ORGANIZATION IS INDEXED
002600         ACCESS IS DYNAMIC
002700         RECORD KEY IS TRANS-KEY.
002800
002900 DATA DIVISION.
003000 FILE SECTION.
003100 FD  CUSTOMER-FILE
003200     LABEL RECORDS ARE STANDARD
003300     BLOCK CONTAINS 10 RECORDS
003400     RECORD CONTAINS 120 CHARACTERS
003500     DATA RECORD IS CUSTOMER-RECORD.
003600 01  CUSTOMER-RECORD.
003700     05  CUST-NUMBER            PIC 9(8).
003800     05  CUST-NAME              PIC X(30).
003900     05  CUST-ADDRESS           PIC X(40).
004000     05  CUST-BALANCE-POUNDS    PIC S9(7)V99 COMP-3.
004100     05  CUST-BALANCE-DOLLARS   PIC S9(9)V99 COMP-3.
004200     05  CUST-STATUS            PIC X.
004300         88  CUST-ACTIVE        VALUE 'A'.
004400         88  CUST-CLOSED        VALUE 'C'.
004500         88  CUST-SUSPENDED     VALUE 'S'.
004600     05  FILLER                 PIC X(30).
004700
004800 FD  TRANSACTION-FILE
004900     LABEL RECORDS ARE STANDARD
005000     RECORD CONTAINS 80 CHARACTERS.
005100 01  TRANSACTION-RECORD.
005200     05  TRANS-KEY.
005300         10  TRANS-CUST-NO      PIC 9(8).
005400         10  TRANS-DATE         PIC 9(6).
005500         10  TRANS-SEQ          PIC 9(4).
005600     05  TRANS-TYPE             PIC X.
005700         88  TRANS-CREDIT       VALUE 'C'.
005800         88  TRANS-DEBIT        VALUE 'D'.
005900     05  TRANS-AMOUNT           PIC S9(9)V99 COMP-3.
006000     05  TRANS-DESC             PIC X(40).
006100     05  FILLER                 PIC X(15).
006200
006300 WORKING-STORAGE SECTION.
006400 77  WS-EOF-FLAG                PIC 9 VALUE 0.
006500     88  END-OF-FILE            VALUE 1.
006600 77  WS-RECORD-COUNT            PIC 9(7) VALUE ZEROS.
006700 77  WS-ERROR-COUNT             PIC 9(5) VALUE ZEROS.
006800 77  WS-TOTAL-CREDITS           PIC S9(11)V99 COMP-3 VALUE 0.
006900 77  WS-TOTAL-DEBITS            PIC S9(11)V99 COMP-3 VALUE 0.
007000 77  WS-CONVERSION-RATE         PIC 9V9(6) VALUE 2.000000.
007100*    CONVERSION RATE: 1 POUND = 2 NZ DOLLARS
007200
007300 01  WS-DATE-FIELDS.
007400     05  WS-CURRENT-DATE        PIC 9(6).
007500     05  WS-CURRENT-DATE-R REDEFINES WS-CURRENT-DATE.
007600         10  WS-YEAR            PIC 99.
007700         10  WS-MONTH           PIC 99.
007800         10  WS-DAY             PIC 99.
007900
008000 01  WS-DISPLAY-FIELDS.
008100     05  WS-DISP-BALANCE        PIC $$$,$$$,$$9.99-.
008200     05  WS-DISP-COUNT          PIC Z,ZZZ,ZZ9.
008300
008400 PROCEDURE DIVISION.
008500 MAIN-CONTROL SECTION.
008600 MAIN-PARA.
008700     PERFORM INITIALISATION.
008800     PERFORM PROCESS-CUSTOMERS UNTIL END-OF-FILE.
008900     PERFORM TERMINATION.
009000     STOP RUN.
009100
009200 INITIALISATION.
009300     OPEN INPUT CUSTOMER-FILE.
009400     OPEN I-O TRANSACTION-FILE.
009500     ACCEPT WS-CURRENT-DATE FROM DATE.
009600     DISPLAY "BANK LEDGER PROCESSING STARTED" UPON CONSOLE.
009700     DISPLAY "DATE: " WS-CURRENT-DATE UPON CONSOLE.
009800
009900 PROCESS-CUSTOMERS.
010000     READ CUSTOMER-FILE
010100         AT END MOVE 1 TO WS-EOF-FLAG
010200         NOT AT END PERFORM PROCESS-ONE-CUSTOMER.
010300
010400 PROCESS-ONE-CUSTOMER.
010500     ADD 1 TO WS-RECORD-COUNT.
010600     IF CUST-ACTIVE
010700         PERFORM CONVERT-TO-DOLLARS
010800         PERFORM UPDATE-BALANCE
010900     ELSE
011000         ADD 1 TO WS-ERROR-COUNT.
011100
011200 CONVERT-TO-DOLLARS.
011300*    CONVERT POUND STERLING TO NZ DOLLARS
011400     COMPUTE CUST-BALANCE-DOLLARS ROUNDED =
011500         CUST-BALANCE-POUNDS * WS-CONVERSION-RATE.
011600
011700 UPDATE-BALANCE.
011800     IF CUST-BALANCE-DOLLARS > 0
011900         ADD CUST-BALANCE-DOLLARS TO WS-TOTAL-CREDITS
012000     ELSE
012100         ADD CUST-BALANCE-DOLLARS TO WS-TOTAL-DEBITS.
012200     REWRITE CUSTOMER-RECORD.
012300
012400 TERMINATION.
012500     CLOSE CUSTOMER-FILE.
012600     CLOSE TRANSACTION-FILE.
012700     MOVE WS-RECORD-COUNT TO WS-DISP-COUNT.
012800     DISPLAY "RECORDS PROCESSED: " WS-DISP-COUNT UPON CONSOLE.
012900     MOVE WS-TOTAL-CREDITS TO WS-DISP-BALANCE.
013000     DISPLAY "TOTAL CREDITS:     " WS-DISP-BALANCE UPON CONSOLE.
013100     MOVE WS-TOTAL-DEBITS TO WS-DISP-BALANCE.
013200     DISPLAY "TOTAL DEBITS:      " WS-DISP-BALANCE UPON CONSOLE.
013300     DISPLAY "BANK LEDGER PROCESSING COMPLETE" UPON CONSOLE.
